name: Create Release Tag
run-name: Create Release Tag
on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Create Release Tag
        id: create_tag
        uses: actions/github-script@v3
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const sha = context.sha
            const repo = context.repo
            let tag_name = `release-1234`
            let tag_message = `Release generated by merging into main branch`
            let create_tag = await github.git.createRef({
              ...repo,
              ref: `refs/tags/${tag_name}`,
              sha: sha
            })
            core.setOutput('tag_name', tag_name);

      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          tag_name: ${{ steps.create_tag.outputs.tag_name }}
          release_name: Release ${{ steps.create_tag.outputs.tag_name }}
          body: |
            Changes in this Release
            - Merged PR into main branch
          draft: false
          prerelease: false
